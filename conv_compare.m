clear;clc;

% % validate F(3x3,3x3)
% % signal transformation matrix
% Bt = [2 -1 -2 1 0; 0 -2 -1 1 0; 0 2 -3 1 0; 0 -1 0 1 0; 0 2 -1 -2 1];
% % filter transformation matrix
% G = [1/2 0 0; -1/2 -1/2 -1/2; -1/6 1/6 -1/6; 1/6 1/3 2/3; 0 0 1];
% % output transformation matrix
% At = [1 1 1 1 0; 0 1 -1 2 0; 0 1 1 4 1];
% 
% g = rand(3,3);
% d = rand(5,5);
% 
% winograd_Y = At*((G*g*G').*(Bt*d*Bt'))*At';
% benchmark_Y = filter2(g,d,'valid');

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% validate F(6x6,3x3)
% Bt = [-36 0 49 0 -14 0 1 0;...
% 0 36 36 -13 -13 1 1 0;...
% 0 -36 36 13 -13 -1 1 0;...
% 0 18 9 -20 -10 2 1 0;...
% 0 -18 9 20 -10 -2 1 0;...
% 0 12 4 -15 -5 3 1 0;...
% 0 -12 4 15 -5 -3 1 0;
% 0 -36 0 49 0 -14 0 1];
% 
% G = [-1/36 0 0;...
% 1/48 1/48 1/48;...
% 1/48 -1/48 1/48;...
% -1/120 -1/60 -1/30;...
% -1/120 1/60 -1/30;...
% 1/720 1/240 1/80;...
% 1/720 -1/240 1/80;...
% 0 0 1];
% 
% At = [1 1 1 1 1 1 1 0;...
% 0 1 -1 2 -2 3 -3 0;...
% 0 1 1 4 4 9 9 0;...
% 0 1 -1 8 -8 27 -27 0;...
% 0 1 1 16 16 81 81 0;...
% 0 1 -1 32 -32 243 -243 1];

Bt = [1 0 -21/4 0 21/4 0 -1 0;...
0 1 1 -17/4 -17/4 1 1 0;...
0 -1 1 17/4 -17/4 -1 1 0;...
0 1/2 1/4 -5/2 -5/4 2 1 0;...
0 -1/2 1/4 5/2 -5/4 -2 1 0;...
0 2 4 -5/2 -5 1/2 1 0;...
0 -2 4 5/2 -5 -1/2 1 0;...
0 -1 0 21/4 0 -21/4 0 1];

G = [1 0 0;...
-2/9 -2/9 -2/9;...
-2/9 2/9 -2/9;...
1/90 1/45 2/45;...
1/90 -1/45 2/45;...
1/45 1/90 1/180;...
1/45 -1/90 1/180;...
0 0 1];

At = [1 1 1 1 1 32 32 0;...
0 1 -1 2 -2 16 -16 0;...
0 1 1 4 4 8 8 0;...
0 1 -1 8 -8 4 -4 0;...
0 1 1 16 16 2 2 0;...
0 1 -1 32 -32 1 -1 1];

g = rand(3,3);
d = rand(8,8);

winograd_Y = At*((G*g*G').*(Bt*d*Bt'))*At';
benchmark_Y = filter2(g,d,'valid');

syms g00 g01 g02 g10 g11 g12 g20 g21 g22;
gg = [g00 g01 g02; g10 g11 g12; g20 g21 g22];
G_g_Gt = G*gg*G';

fp = fopen('weight_transform.txt','w');
for y = 1:8
	for x = 1:8
		fprintf(fp,'%s\n',G_g_Gt(y,x));
	end
	fprintf(fp,'\n\n\n');
end
fclose(fp);

transf_g1 = G*g*G';
transf_g2 = double(subs(G_g_Gt,gg,g));

syms d00 d01 d02 d03 d04 d05 d06 d07 d10 d11 d12 d13 d14 d15 d16 d17 d20 d21 d22 d23 d24 d25 d26 d27 d30 d31 d32 d33 d34 d35 d36 d37 d40 d41 d42 d43 d44 d45 d46 d47 d50 d51 d52 d53 d54 d55 d56 d57 d60 d61 d62 d63 d64 d65 d66 d67 d70 d71 d72 d73 d74 d75 d76 d77;
dd = [d00 d01 d02 d03 d04 d05 d06 d07; d10 d11 d12 d13 d14 d15 d16 d17; d20 d21 d22 d23 d24 d25 d26 d27; d30 d31 d32 d33 d34 d35 d36 d37; d40 d41 d42 d43 d44 d45 d46 d47; d50 d51 d52 d53 d54 d55 d56 d57; d60 d61 d62 d63 d64 d65 d66 d67; d70 d71 d72 d73 d74 d75 d76 d77];
Bt_d_B = Bt*dd*Bt';

fp = fopen('input_transform.txt','w');
for y = 1:8
	for x = 1:8
		fprintf(fp,'%s\n',Bt_d_B(y,x));
	end
	fprintf(fp,'\n\n\n');
end
fclose(fp);

transf_d1 = Bt*d*Bt';
transf_d2 = double(subs(Bt_d_B,dd,d));

mm = sym('m',[8,8]);
At_m_A = At*mm*At';

fp = fopen('output_transform.txt','w');
for y = 1:6
	for x = 1:6
		fprintf(fp,'%s\n',At_m_A(y,x));
	end
	fprintf(fp,'\n\n\n');
end
fclose(fp);

m = transf_g1.*transf_d1;
transf_o1 = At*m*At';
transf_o2 = double(subs(At_m_A,mm,m));